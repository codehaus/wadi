<?xml version="1.0"  encoding="ISO-8859-1"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <bean
    id="SessionFactory"
    class="org.codehaus.wadi.impl.DistributableSessionFactory"
    >
  </bean>

  <bean
    id="SessionPool"
    class="org.codehaus.wadi.impl.SimpleSessionPool"
    >
    <constructor-arg><ref bean="SessionFactory"/></constructor-arg>
  </bean>

  <bean
    id="AttributesFactory"
    class="org.codehaus.wadi.impl.DistributableAttributesFactory"
    >
  </bean>

  <bean
    id="ValueFactory"
    class="org.codehaus.wadi.impl.DistributableValueFactory"
    >
  </bean>

  <bean
    id="ValuePool"
    class="org.codehaus.wadi.impl.SimpleValuePool"
    >
    <constructor-arg><ref bean="ValueFactory"/></constructor-arg>
  </bean>

  <bean
    id="SessionWrapperFactory"
    class="org.codehaus.wadi.impl.jetty.JettySessionWrapperFactory"
    >
  </bean>

  <bean
    id="SessionIdFactory"
    class="org.codehaus.wadi.impl.TomcatSessionIdFactory"
    >
  </bean>

  <bean
    id="Streamer"
    class="org.codehaus.wadi.impl.SimpleStreamer"
    >
  </bean>

  <!-- the Contextualiser stack...(shorthand for now) -->

  <bean
    id="SessionMap"
    class="EDU.oswego.cs.dl.util.concurrent.ConcurrentHashMap"
    >
  </bean>

  <bean
    id="DataSource"
    class="org.axiondb.jdbc.AxionDataSource"
    >
    <constructor-arg><value>jdbc:axiondb:testdb</value></constructor-arg>
  </bean>

  <bean
    id="ContextPool"
    class="org.codehaus.wadi.impl.SessionToContextPoolAdapter"
    >
    <constructor-arg><ref bean="SessionPool"/></constructor-arg>
  </bean>

<!--
  <bean
    id="Relocater"
    class="org.codehaus.wadi.impl.MessagingMigratingRelocater"
    >
    <constructor-arg type="long" index="0"><value>2000</value></constructor-arg>
    <constructor-arg type="long" index="1"><value>1000</value></constructor-arg>
  </bean>

  <bean
    id="Relocater"
    class="org.codehaus.wadi.impl.ProxyingRelocater"
    >
    <constructor-arg type="long" index="0"><value>2000</value></constructor-arg>
    <constructor-arg type="long" index="1"><value>2000</value></constructor-arg>
  </bean>
-->

  <bean
    id="Relocater"
    class="org.codehaus.wadi.impl.HybridRelocater"
    >
    <constructor-arg type="long" index="0"><value>2000</value></constructor-arg>
    <constructor-arg type="long" index="1"><value>2000</value></constructor-arg>
<!--
    <constructor-arg type="boolean"><value>false</value></constructor-arg>
-->
    <constructor-arg type="boolean"><value>true</value></constructor-arg>
  </bean>

  <bean
    id="Contextualiser"
    class="org.codehaus.wadi.impl.SimpleContextualiserStack"
    >
    <constructor-arg><ref bean="SessionMap"/></constructor-arg>
    <constructor-arg><ref bean="ContextPool"/></constructor-arg> <!-- enclosed SessionPool will be init()-ed by Manager -->
    <constructor-arg><ref bean="DataSource"/></constructor-arg>
    <constructor-arg><ref bean="Relocater"/></constructor-arg>
  </bean>

  <!-- the Router (load-balancer integration) -->

<!--
  <bean
    id="Router"
    class="org.codehaus.wadi.impl.JkRouter"
    >
    <constructor-arg><value>${node.name}</value></constructor-arg>
  </bean>
-->

  <bean
    id="Router"
    class="org.codehaus.wadi.impl.DummyRouter"
    >
  </bean>

  <!-- other stuff... -->

  <bean
    id="HttpProxy"
    class="org.codehaus.wadi.impl.StandardHttpProxy"
    >
    <constructor-arg><value>jsessionid</value></constructor-arg>
  </bean>

  <bean
    id="LocalHost"
    class="java.net.InetAddress"
    factory-method="getLocalHost"
    >
  </bean>

  <bean
    id="HttpAddress"
    class="java.net.InetSocketAddress"
    >
    <constructor-arg><ref bean="LocalHost"/></constructor-arg>
    <constructor-arg type="int"><value>${http.port}</value></constructor-arg>
  </bean>

  <!-- and finally - the SessionManager itself -->

  <bean
    id="SessionManager"
    class="org.codehaus.wadi.impl.jetty.JettyManager"
    >
    <constructor-arg><ref bean="SessionPool"/></constructor-arg>
    <constructor-arg><ref bean="AttributesFactory"/></constructor-arg>
    <constructor-arg><ref bean="ValuePool"/></constructor-arg>
    <constructor-arg><ref bean="SessionWrapperFactory"/></constructor-arg>
    <constructor-arg><ref bean="SessionIdFactory"/></constructor-arg>
    <constructor-arg><ref bean="Contextualiser"/></constructor-arg>
    <constructor-arg><ref bean="SessionMap"/></constructor-arg>
    <constructor-arg><ref bean="Router"/></constructor-arg>
    <constructor-arg><ref bean="Streamer"/></constructor-arg>
    <constructor-arg type="boolean"><value>true</value></constructor-arg>
    <constructor-arg index="10"><value>tcp://localhost:61616</value></constructor-arg>
<!--
    <constructor-arg index="10"><value>peer://org.codehaus.wadi</value></constructor-arg>
 -->
    <constructor-arg index="11"><value>CLUSTER0</value></constructor-arg>
    <constructor-arg index="12"><value>${node.name}</value></constructor-arg>
    <constructor-arg><ref bean="HttpProxy"/></constructor-arg>
    <constructor-arg><ref bean="HttpAddress"/></constructor-arg>
    <constructor-arg index="15"><value>72</value></constructor-arg>
  </bean>


<!-- JMX support -->

<!--
    <property name="beans">
      <map>
        <entry key="bean:name=testBean1">
	  <ref bean="SessionManager"/>
	</entry>
      </map>
    </property>
-->

    <!--
    <property name="serviceUrl" value="service:jmx:rmi:///jndi/rmi://localhost:9875"/>
    -->

  <bean id="mbeanServer" class="org.springframework.jmx.support.MBeanServerFactoryBean"/>

  <bean id="exporter" class="org.springframework.jmx.export.MBeanExporter">
    <property name="autodetect"><value>true</value></property>
    <property name="server" ref="mbeanServer"/>
  </bean>

  <bean id="serverConnector" class="org.springframework.jmx.support.ConnectorServerFactoryBean">
    <property name="objectName" value="connector:name=rmi"/>
    <property name="serviceUrl" value="service:jmx:rmi://localhost:9875"/>
    <property name="server"><ref local="mbeanServer"/></property>
    <property name="threaded" value="true"/>
    <property name="daemon" value="true"/>
  </bean>

  <bean id="clientConnector" class="org.springframework.jmx.support.MBeanServerConnectionFactoryBean">
    <property name="serviceUrl" value="service:jmx:rmi:///jndi/rmi://localhost:9875"/>
  </bean>

<!--  -->

</beans>

