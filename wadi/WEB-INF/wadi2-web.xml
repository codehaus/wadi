<?xml version="1.0"  encoding="ISO-8859-1"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <bean
    id="SessionFactory"
    class="org.codehaus.wadi.impl.DistributableSessionFactory"
    >
  </bean>

  <bean
    id="SessionPool"
    class="org.codehaus.wadi.impl.SimpleSessionPool"
    >
    <constructor-arg><ref bean="SessionFactory"/></constructor-arg>
  </bean>

  <bean
    id="AttributesFactory"
    class="org.codehaus.wadi.impl.DistributableAttributesFactory"
    >
  </bean>

  <bean
    id="ValueFactory"
    class="org.codehaus.wadi.impl.DistributableValueFactory"
    >
  </bean>

  <bean
    id="ValuePool"
    class="org.codehaus.wadi.impl.SimpleValuePool"
    >
    <constructor-arg><ref bean="ValueFactory"/></constructor-arg>
  </bean>

  <bean
    id="SessionWrapperFactory"
    class="org.codehaus.wadi.impl.jetty.JettySessionWrapperFactory"
    >
  </bean>

  <bean
    id="SessionIdFactory"
    class="org.codehaus.wadi.impl.TomcatSessionIdFactory"
    >
  </bean>

  <bean
    id="Streamer"
    class="org.codehaus.wadi.impl.SimpleStreamer"
    >
  </bean>

  <!-- the Cluster Connection -->

  <bean
    id="ConnectionFactory"
    class="org.codehaus.wadi.impl.Utils"
    factory-method="getConnectionFactory"
    >
  </bean>

  <bean
    id="ClusterFactory"
    class="org.codehaus.wadi.impl.CustomClusterFactory"
    >
    <constructor-arg><ref bean="ConnectionFactory"/></constructor-arg>
  </bean>

  <bean
    id="Cluster"
    factory-bean="ClusterFactory"
    factory-method="createCluster"
    >
    <constructor-arg><value>ORG.CODEHAUS.WADI.TEST.CLUSTER</value></constructor-arg>
  </bean>

  <!-- the Contextualiser stack...(shorthand for now) -->

  <bean
    id="SessionMap"
    class="EDU.oswego.cs.dl.util.concurrent.ConcurrentHashMap"
    >
  </bean>

  <bean
    id="DataSource"
    class="org.axiondb.jdbc.AxionDataSource"
    >
    <constructor-arg><value>jdbc:axiondb:testdb</value></constructor-arg>
  </bean>

  <bean
    id="ContextPool"
    class="org.codehaus.wadi.impl.SessionToContextPoolAdapter"
    >
    <constructor-arg><ref bean="SessionPool"/></constructor-arg>
  </bean>

  <bean
    id="Contextualiser"
    class="org.codehaus.wadi.impl.SimpleContextualiserStack"
    >
    <constructor-arg><ref bean="SessionMap"/></constructor-arg>
    <constructor-arg><ref bean="ContextPool"/></constructor-arg> <!-- enclosed SessionPool will be init()-ed by Manager -->
    <constructor-arg><ref bean="DataSource"/></constructor-arg>
    <constructor-arg type="int"><value>${http.port}</value></constructor-arg>
    <constructor-arg><ref bean="Cluster"/></constructor-arg>
  </bean>

  <!-- the Router (load-balancer integration) -->

  <bean
    id="Router"
    class="org.codehaus.wadi.impl.JkRouter"
    >
    <constructor-arg><value>${wadi.colour}</value></constructor-arg>
  </bean>


  <!-- the P2P Server -->
  <!-- TODO: some decent comments -->

  <bean
    id="Buffer"
    class="EDU.oswego.cs.dl.util.concurrent.BoundedBuffer"
    >
    <constructor-arg type="int"><value>10</value></constructor-arg>
  </bean>

  <bean
    id="Executor"
    class="EDU.oswego.cs.dl.util.concurrent.PooledExecutor"
    >
    <constructor-arg><ref bean="Buffer"/></constructor-arg>
    <constructor-arg type="int"><value>100</value></constructor-arg>
  </bean>

  <bean
    id="Server"
    class="org.codehaus.wadi.io.impl.ClusterServer"
    >
    <constructor-arg><ref bean="Executor"/></constructor-arg>
    <constructor-arg type="long"><value>5000</value></constructor-arg><!-- timeout -->
    <constructor-arg type="boolean"><value>true</value></constructor-arg><!-- excludeSelf -->
  </bean>

  <!-- and finally - the SessionManager itself -->

  <bean
    id="SessionManager"
    class="org.codehaus.wadi.impl.jetty.JettyManager"
    >
    <constructor-arg><ref bean="SessionPool"/></constructor-arg>
    <constructor-arg><ref bean="AttributesFactory"/></constructor-arg>
    <constructor-arg><ref bean="ValuePool"/></constructor-arg>
    <constructor-arg><ref bean="SessionWrapperFactory"/></constructor-arg>
    <constructor-arg><ref bean="SessionIdFactory"/></constructor-arg>
    <constructor-arg><ref bean="Contextualiser"/></constructor-arg>
    <constructor-arg><ref bean="SessionMap"/></constructor-arg>
    <constructor-arg><ref bean="Streamer"/></constructor-arg>
    <constructor-arg type="boolean"><value>true</value></constructor-arg>
    <constructor-arg><ref bean="Cluster"/></constructor-arg>
    <constructor-arg><ref bean="Server"/></constructor-arg>
    <constructor-arg><ref bean="Router"/></constructor-arg>
  </bean>

</beans>
