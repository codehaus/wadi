<?xml version="1.0"  encoding="ISO-8859-1"?>

<!DOCTYPE beans PUBLIC "-//SPRING//DTD BEAN//EN" "http://www.springframework.org/dtd/spring-beans.dtd">

<beans>

  <bean
    id="ConnectionFactory"
    class="org.codehaus.activemq.ActiveMQConnectionFactory"
    >
    <!-- <constructor-arg><value>vm://localhost</value></constructor-arg> -->
    <!-- <constructor-arg><value>multicast://224.1.2.3:5123</value></constructor-arg> -->
    <!-- <constructor-arg><value>peer://WADI-0</value></constructor-arg> -->
    <constructor-arg><value>tcp://localhost:61616</value></constructor-arg>
  </bean>

  <bean
    id="ManagerFactory"
    class="org.codehaus.wadi.SpringManagerFactory"
    >
    <constructor-arg><ref bean="Manager"/></constructor-arg>
  </bean>

  <bean
    id="ConfiguredManager"
    factory-bean="ManagerFactory"
    factory-method="getManager"
    >

    <!-- how did we create our connection to the cluster ? -->
    <property name="connectionFactory">
      <ref bean="ConnectionFactory"/>
    </property><!-- not needed now ? -->

    <!-- Our connection to the cluster -->
    <property name="connection">
      <bean
	name="dummy"
	factory-bean="ConnectionFactory"
	factory-method="createConnection"
	>
      </bean>
    </property>

    <!-- How should session migration be implemented ? -->
    <property name="migrationService">
      <!--
      <bean class="org.codehaus.wadi.impl.MessagedMigrationService" />
      -->
      <bean class="org.codehaus.wadi.impl.StreamedMigrationService">
	<property name="timeout"><value>5000</value></property>
      </bean>
    </property>

    <!-- used to stream sessions between peers -->
    <property name="streamingStrategy">
      <bean class="org.codehaus.wadi.impl.SimpleStreamingStrategy"/>
    </property>

    <!-- used to select long-term storage mechanism -->
    <property name="passivationStrategy">
      <bean class="org.codehaus.wadi.impl.FilePassivationStrategy" >
	<constructor-arg><value>${wadi.home}/tmp</value></constructor-arg>
	<!-- used to stream sessions to/from storage -->
	<property name="streamingStrategy">
	  <bean class="org.codehaus.wadi.impl.GZIPStreamingStrategy"/>
	</property>
      </bean>
    </property>

    <!-- used to decide when to evict a session -->
    <property name="evictionPolicy">
      <bean class="org.codehaus.wadi.impl.AbsoluteEvictionPolicy">
	<constructor-arg index="0"><value>300</value></constructor-arg><!-- evict after 5 mins of inactivity -->
      </bean>
    </property>

    <!-- used to decide how session ids should be generated -->
    <property name="idGenerator">
      <bean class="org.codehaus.wadi.impl.TomcatIdGenerator"/>
    </property>

    <!-- manage coordination with load-balancer -->
    <property name="routingStrategy">
      <!-- if you are using Apache/mod_jk uncomment this for affinity -->
      <!--
      <bean class="org.codehaus.wadi.impl.JkRoutingStrategy">
      <constructor-arg><value>${wadi.colour}</value></constructor-arg>
      </bean>
      -->
      <!-- else use this... -->
      <bean class="org.codehaus.wadi.impl.NoRoutingStrategy"/>
    </property>

  </bean>

</beans>
